{"ast":null,"code":"import{createSlice,createAsyncThunk}from'@reduxjs/toolkit';import axios from'axios';// Use relative URL to leverage the proxy configuration in package.json\nconst API_URL='/api';// Get user from localStorage\nconst getUserFromStorage=()=>{try{const user=localStorage.getItem('user');return user?JSON.parse(user):null;}catch(error){console.error('Error parsing user from localStorage:',error);// Clear corrupted storage\nlocalStorage.removeItem('user');return null;}};const user=getUserFromStorage();const initialState={user:user?user:null,isError:false,isSuccess:false,isLoading:false,message:''};// Get current user\nexport const getCurrentUser=createAsyncThunk('auth/getCurrentUser',async(_,thunkAPI)=>{try{var _thunkAPI$getState$au;console.log('Getting current user');const token=(_thunkAPI$getState$au=thunkAPI.getState().auth.user)===null||_thunkAPI$getState$au===void 0?void 0:_thunkAPI$getState$au.token;if(!token){console.error('No token found when getting current user');return thunkAPI.rejectWithValue('No token found');}const config={headers:{'x-auth-token':token}};console.log(`Making request to ${API_URL}/auth/me with token: ${token.substring(0,10)}...`);const response=await axios.get(`${API_URL}/auth/me`,config);console.log('Current user fetch successful:',response.data);return response.data;}catch(error){console.error('Error getting current user:',error);// Detailed error logging\nif(error.response){console.error('Error response data:',error.response.data);console.error('Error response status:',error.response.status);}else if(error.request){console.error('Error request:',error.request);}const message=error.response&&error.response.data&&error.response.data.msg||error.message||error.toString();// Logout user if token is invalid\nif(error.response&&error.response.status===401){console.warn('Token invalid, removing user from localStorage');localStorage.removeItem('user');}return thunkAPI.rejectWithValue(message);}});// Login user (when receiving token from Google OAuth callback)\nexport const loginWithToken=createAsyncThunk('auth/loginWithToken',async(token,thunkAPI)=>{try{console.log('Logging in with token');if(!token){console.error('No token provided for login');return thunkAPI.rejectWithValue('No token provided');}// Save the token to localStorage\nconst userData={token};localStorage.setItem('user',JSON.stringify(userData));// Get user details\nconst config={headers:{'x-auth-token':token}};console.log(`Getting user details from ${API_URL}/auth/me with token: ${token.substring(0,10)}...`);const response=await axios.get(`${API_URL}/auth/me`,config);console.log('User details retrieved successfully:',response.data);// Return user data along with token\nreturn{...response.data,token};}catch(error){console.error('Error logging in with token:',error);// Detailed error logging\nif(error.response){console.error('Error response data:',error.response.data);console.error('Error response status:',error.response.status);}const message=error.response&&error.response.data&&error.response.data.msg||error.message||error.toString();// Remove invalid token\nlocalStorage.removeItem('user');return thunkAPI.rejectWithValue(message);}});// Logout user\nexport const logout=createAsyncThunk('auth/logout',async()=>{localStorage.removeItem('user');console.log('User logged out, localStorage cleared');});export const authSlice=createSlice({name:'auth',initialState,reducers:{reset:state=>{state.isLoading=false;state.isSuccess=false;state.isError=false;state.message='';}},extraReducers:builder=>{builder.addCase(getCurrentUser.pending,state=>{state.isLoading=true;state.isError=false;}).addCase(getCurrentUser.fulfilled,(state,action)=>{state.isLoading=false;state.isSuccess=true;state.user={...state.user,...action.payload};}).addCase(getCurrentUser.rejected,(state,action)=>{state.isLoading=false;state.isError=true;state.message=action.payload;state.user=null;}).addCase(loginWithToken.pending,state=>{state.isLoading=true;state.isError=false;}).addCase(loginWithToken.fulfilled,(state,action)=>{state.isLoading=false;state.isSuccess=true;state.user=action.payload;}).addCase(loginWithToken.rejected,(state,action)=>{state.isLoading=false;state.isError=true;state.message=action.payload;state.user=null;}).addCase(logout.fulfilled,state=>{state.user=null;});}});export const{reset}=authSlice.actions;export default authSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","axios","API_URL","getUserFromStorage","user","localStorage","getItem","JSON","parse","error","console","removeItem","initialState","isError","isSuccess","isLoading","message","getCurrentUser","_","thunkAPI","_thunkAPI$getState$au","log","token","getState","auth","rejectWithValue","config","headers","substring","response","get","data","status","request","msg","toString","warn","loginWithToken","userData","setItem","stringify","logout","authSlice","name","reducers","reset","state","extraReducers","builder","addCase","pending","fulfilled","action","payload","rejected","actions","reducer"],"sources":["C:/Users/harsh/Desktop/Ai-content generator/frontend/src/features/auth/authSlice.jsx"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\r\nimport axios from 'axios';\r\n\r\n// Use relative URL to leverage the proxy configuration in package.json\r\nconst API_URL = '/api';\r\n\r\n// Get user from localStorage\r\nconst getUserFromStorage = () => {\r\n  try {\r\n    const user = localStorage.getItem('user');\r\n    return user ? JSON.parse(user) : null;\r\n  } catch (error) {\r\n    console.error('Error parsing user from localStorage:', error);\r\n    // Clear corrupted storage\r\n    localStorage.removeItem('user');\r\n    return null;\r\n  }\r\n};\r\n\r\nconst user = getUserFromStorage();\r\n\r\nconst initialState = {\r\n  user: user ? user : null,\r\n  isError: false,\r\n  isSuccess: false,\r\n  isLoading: false,\r\n  message: '',\r\n};\r\n\r\n// Get current user\r\nexport const getCurrentUser = createAsyncThunk(\r\n  'auth/getCurrentUser',\r\n  async (_, thunkAPI) => {\r\n    try {\r\n      console.log('Getting current user');\r\n      const token = thunkAPI.getState().auth.user?.token;\r\n      \r\n      if (!token) {\r\n        console.error('No token found when getting current user');\r\n        return thunkAPI.rejectWithValue('No token found');\r\n      }\r\n\r\n      const config = {\r\n        headers: {\r\n          'x-auth-token': token,\r\n        },\r\n      };\r\n\r\n      console.log(`Making request to ${API_URL}/auth/me with token: ${token.substring(0, 10)}...`);\r\n      const response = await axios.get(`${API_URL}/auth/me`, config);\r\n      console.log('Current user fetch successful:', response.data);\r\n      return response.data;\r\n    } catch (error) {\r\n      console.error('Error getting current user:', error);\r\n      \r\n      // Detailed error logging\r\n      if (error.response) {\r\n        console.error('Error response data:', error.response.data);\r\n        console.error('Error response status:', error.response.status);\r\n      } else if (error.request) {\r\n        console.error('Error request:', error.request);\r\n      }\r\n      \r\n      const message = \r\n        (error.response && \r\n          error.response.data && \r\n          error.response.data.msg) ||\r\n        error.message ||\r\n        error.toString();\r\n      \r\n      // Logout user if token is invalid\r\n      if (error.response && error.response.status === 401) {\r\n        console.warn('Token invalid, removing user from localStorage');\r\n        localStorage.removeItem('user');\r\n      }\r\n\r\n      return thunkAPI.rejectWithValue(message);\r\n    }\r\n  }\r\n);\r\n\r\n// Login user (when receiving token from Google OAuth callback)\r\nexport const loginWithToken = createAsyncThunk(\r\n  'auth/loginWithToken',\r\n  async (token, thunkAPI) => {\r\n    try {\r\n      console.log('Logging in with token');\r\n      if (!token) {\r\n        console.error('No token provided for login');\r\n        return thunkAPI.rejectWithValue('No token provided');\r\n      }\r\n      \r\n      // Save the token to localStorage\r\n      const userData = { token };\r\n      localStorage.setItem('user', JSON.stringify(userData));\r\n\r\n      // Get user details\r\n      const config = {\r\n        headers: {\r\n          'x-auth-token': token,\r\n        },\r\n      };\r\n\r\n      console.log(`Getting user details from ${API_URL}/auth/me with token: ${token.substring(0, 10)}...`);\r\n      const response = await axios.get(`${API_URL}/auth/me`, config);\r\n      console.log('User details retrieved successfully:', response.data);\r\n      \r\n      // Return user data along with token\r\n      return { ...response.data, token };\r\n    } catch (error) {\r\n      console.error('Error logging in with token:', error);\r\n      \r\n      // Detailed error logging\r\n      if (error.response) {\r\n        console.error('Error response data:', error.response.data);\r\n        console.error('Error response status:', error.response.status);\r\n      }\r\n      \r\n      const message = \r\n        (error.response && \r\n          error.response.data && \r\n          error.response.data.msg) ||\r\n        error.message ||\r\n        error.toString();\r\n      \r\n      // Remove invalid token\r\n      localStorage.removeItem('user');\r\n      \r\n      return thunkAPI.rejectWithValue(message);\r\n    }\r\n  }\r\n);\r\n\r\n// Logout user\r\nexport const logout = createAsyncThunk('auth/logout', async () => {\r\n  localStorage.removeItem('user');\r\n  console.log('User logged out, localStorage cleared');\r\n});\r\n\r\nexport const authSlice = createSlice({\r\n  name: 'auth',\r\n  initialState,\r\n  reducers: {\r\n    reset: (state) => {\r\n      state.isLoading = false;\r\n      state.isSuccess = false;\r\n      state.isError = false;\r\n      state.message = '';\r\n    },\r\n  },\r\n  extraReducers: (builder) => {\r\n    builder\r\n      .addCase(getCurrentUser.pending, (state) => {\r\n        state.isLoading = true;\r\n        state.isError = false;\r\n      })\r\n      .addCase(getCurrentUser.fulfilled, (state, action) => {\r\n        state.isLoading = false;\r\n        state.isSuccess = true;\r\n        state.user = { ...state.user, ...action.payload };\r\n      })\r\n      .addCase(getCurrentUser.rejected, (state, action) => {\r\n        state.isLoading = false;\r\n        state.isError = true;\r\n        state.message = action.payload;\r\n        state.user = null;\r\n      })\r\n      .addCase(loginWithToken.pending, (state) => {\r\n        state.isLoading = true;\r\n        state.isError = false;\r\n      })\r\n      .addCase(loginWithToken.fulfilled, (state, action) => {\r\n        state.isLoading = false;\r\n        state.isSuccess = true;\r\n        state.user = action.payload;\r\n      })\r\n      .addCase(loginWithToken.rejected, (state, action) => {\r\n        state.isLoading = false;\r\n        state.isError = true;\r\n        state.message = action.payload;\r\n        state.user = null;\r\n      })\r\n      .addCase(logout.fulfilled, (state) => {\r\n        state.user = null;\r\n      });\r\n  },\r\n});\r\n\r\nexport const { reset } = authSlice.actions;\r\nexport default authSlice.reducer; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}